{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %} 广东碧云量尺跟单系统 {% endblock %}

{% block page_content %}
    {#    <div class="page-header">#}
    {#    <h4>订货员：{{ current_user.username }}</h4>#}
    {#        <p>订货列表</p>#}
    {#    </div>#}

    {#    <div class="panel panel-default">#}
    {#        <div class="panel-heading">#}
    {#            <h4>{{ done }}#}
    {#                {% if done=='已入库' %}#}
    {#                    <a class="btn btn-success" href="{{ url_for('main.rukulist') }}">转－待入库</a>#}
    {#                {% else %}#}
    {#                    <a class="btn btn-primary " href="{{ url_for('main.rukuedlist') }}">转－已入库</a>#}
    {#                {% endif %}</h4>#}
    {#        </div>#}
    {#    </div>#}

    <div class="panel panel-primary">
        <div class="panel-heading">
        </div>
        <div class="post-body">
            <blockquote>
                {{ wtf.quick_form(form) }}
            </blockquote>
        </div>
        <div class="panel-footer"></div>
    </div>



    {% if status == 0 %}

        {% for kehu in kehus %}

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4>

                        {#                    客户: {{ kehu.id }}#}


                        <p>房间: {{ kehu.xiaoqu.xiaoqu }} 「 {{ kehu.xiaoqu.dizhi }} 」{{ kehu.fangjian }}</p>
                        <p>客户: ({{ kehu.id }}){{ kehu.chenghu }}（{{ kehu.tel }}）
{#                            {% if kehu.status == 1 %}#}
{#                                已测尺#}
{#                            {% elif kehu.status == 2 %}#}
{#                                已下单#}
{#                            {% elif kehu.status == 3 %}#}
{#                                已安装#}
{#                            {% elif kehu.status == 4 %}#}
{#                                已清款#}
{#                            {% else %}#}
{#                                状态有误#}
{#                            {% endif %}#}
                        </p>
                    </h4>

                    {#                    <blockquote>#}
                    {#                        <ul class="list-unstyled">#}
                    {#                            <li>房间: {{ kehu.xiaoqu.xiaoqu }} 「 {{ kehu.xiaoqu.dizhi }} 」{{ kehu.fangjian }}</li>#}
                    {#                            <li>客户: {{ kehu.chenghu }}（{{ kehu.tel }}）#}
                    {#                                {% if kehu.status == 1 %}#}
                    {#                                    已测尺#}
                    {#                                {% elif kehu.status == 2 %}#}
                    {#                                    已下单#}
                    {#                                {% elif kehu.status == 3 %}#}
                    {#                                    已安装#}
                    {#                                {% elif kehu.status == 4 %}#}
                    {#                                    已清款#}
                    {#                                {% else %}#}
                    {#                                    状态有误#}
                    {#                                {% endif %}#}
                    {#                            </li>#}
                    {#                            <li>备注: {{ kehu.beizhu }}</li>#}
                    {#                        </ul>#}
                    {#                    </blockquote>#}
                </div>
                <div>
                    <blockquote>


                        {#                    #}
                        {#                        <table class="table table-striped table-condensed">#}
                        {#                            <thead>#}
                        {#                            <tr>#}
                        {#                                <th>No</th>#}
                        {#                                <th>产品</th>#}
                        {#                                <th>位置</th>#}
                        {#                                <th>状态</th>#}
                        {#                            </tr>#}
                        {#                            </thead>#}
                        {#                            <tbody>#}
                        {#                            {% for dingdan in kehu.dingdans %}#}
                        {#                                <tr>#}
                        {#                                    <td>{{ loop.index }}</td>#}
                        {#                                    <td>{{ dingdan.chanpin.pinming }}</td>#}
                        {#                                    <td>{{ dingdan.weizhi }}</td>#}
                        {#                                    <td>#}
                        {##}
                        {#                            {{ dingdan.status }}#}
                        {##}
                        {#                                        {% if dingdan.status == 1 %}#}
                        {#                                            「已量尺」#}
                        {#                                        {% elif dingdan.status == 2 %}#}
                        {#                                            「已下单」#}
                        {#                                        {% elif dingdan.status == 3 %}#}
                        {#                                            「已订货」#}
                        {#                                            <label class="checkbox-inline"><input name="willsel" type="checkbox"#}
                        {#                                                                                  value="{{ dingdan.id }}"/>选择</label>#}
                        {#                                        {% elif dingdan.status == 4 %}#}
                        {#                                            「已入库」#}
                        {#                                        {% elif dingdan.status == 5 %}#}
                        {#                                            「已发货」#}
                        {##}
                        {#                                        {% elif dingdan.status == 6 %}#}
                        {#                                            「已收货」#}
                        {#                                            ( {{ moment(dingdan.time5).fromNow(refresh=True) }} 收货)#}
                        {#                                            <a class="btn btn-danger  glyphicon glyphicon-repeat"#}
                        {#                                               href="{{ url_for('main.unshouhuoone', ddid=dingdan.id) }}"> 撤收</a>#}
                        {#                                        {% elif dingdan.status == 7 %}#}
                        {#                                            「安装中」#}
                        {#                                        {% elif dingdan.status == 8 %}#}
                        {#                                            「完成安装」#}
                        {#                                        {% elif dingdan.status == 9 %}#}
                        {#                                            「已清款」#}
                        {#                                        {% else %}#}
                        {#                                            「状态有误」#}
                        {#                                        {% endif %}#}
                        {##}
                        {##}
                        {#                                    </td>#}
                        {#                                </tr>#}
                        {#                            {% endfor %}#}
                        {#                            </tbody>#}
                        {#                        </table>#}




                        {% for dingdan in kehu.dingdans %}

                            {% if dingdan.chanpin_id==chanpin or chanpin==0 %}

                                <div class="panel panel-default">

                                    <div class="panel-heading">
                                        {% if dingdan.status == 3 %}

                                            <label class="checkbox-inline"><input name="willsel" type="checkbox"
                                                                                  value="{{ dingdan.id }}"/>选择
                                            「已订货」
                                        {% elif dingdan.status == 6 %}
                                            「已收货」
{#                            ( {{ moment(dingdan.time5).fromNow(refresh=True) }} 收货)#}
                            ({{ moment(dingdan.time6).format('YY年M月D日') }} 收货)
                                            <a class="btn btn-danger  glyphicon glyphicon-repeat"
                                               href="{{ url_for('main.unshouhuoone', ddid=dingdan.id) }}"> 撤收</a>
                                        {% endif %}
                                        [ {{ dingdan.id }} ] {{ dingdan.chanpin.pinming }}
                                    </label>
                                    </div>

                                    <div class="post-body">
                                        <blockquote>
                                            <ul class="list-unstyled">

                                                {% if dingdan.chanpin.pinming == '隐形网' %}


                                                    <li>位置: {{ dingdan.weizhi }}</li>
                                                    {#                                                <li>数量: {{ dingdan.shuliang }}</li>#}
                                                    <li>型号: {{ dingdan.xinghao }}</li>
                                                    <li>宽(mm): {{ dingdan.kuan_chang }}</li>
                                                    <li>高(mm): {{ dingdan.gao }}</li>
                                                    <li>颜色: {{ dingdan.color }}</li>

                                                {% elif dingdan.chanpin.pinming == '阳台窗' %}


                                                    <li>位置: {{ dingdan.weizhi }}</li>
                                                    {#                                                <li>数量: {{ dingdan.shuliang }}</li>#}
                                                    <li>型号: {{ dingdan.xinghao }}</li>
                                                    <li>宽(mm): {{ dingdan.kuan_chang }}</li>
                                                    <li>高(mm): {{ dingdan.gao }}</li>

                                                    <li>窗台高(mm): {{ dingdan.meikuan_digao }}</li>
                                                    <li>栏高(mm): {{ dingdan.shanshu }}</li>
                                                    <li>管位: {{ dingdan.shuowei }}</li>

                                                    <li>颜色: {{ dingdan.color }}</li>

                                                {% elif dingdan.chanpin.pinming == '纱门' %}


                                                    <li>位置: {{ dingdan.weizhi }}</li>
                                                    {#                                                <li>数量: {{ dingdan.shuliang }}</li>#}
                                                    <li>型号: {{ dingdan.xinghao }}</li>
                                                    <li>宽(mm): {{ dingdan.kuan_chang }}</li>
                                                    <li>高(mm): {{ dingdan.gao }}</li>
                                                    <li>颜色: {{ dingdan.color }}</li>

                                                    <li>内空宽(mm): {{ dingdan.meikuan_digao }}</li>
                                                    <li>扇数: {{ dingdan.shanshu }}</li>
                                                    <li>中横条数: {{ dingdan.zhonghengtiaoshu_gantiaoshu }}</li>
                                                    <li>锁位: {{ dingdan.shuowei }}</li>
                                                    <li>装法: {{ dingdan.zhangfa }}</li>


                                                {% elif dingdan.chanpin.pinming == '晾衣杆' or dingdan.chanpin.pinming == '晾衣机' %}

                                                    <li>位置: {{ dingdan.weizhi }}</li>
                                                    {#                                                <li>数量: {{ dingdan.shuliang }}</li>#}
                                                    <li>型号: {{ dingdan.xinghao }}</li>
                                                    <li>长(mm): {{ dingdan.kuan_chang }}</li>
                                                    <li>高(mm): {{ dingdan.gao }}</li>
                                                    <li>颜色: {{ dingdan.color }}</li>
                                                    <li>杆条数: {{ dingdan.zhonghengtiaoshu_gantiaoshu }}</li>




                                                {% elif dingdan.chanpin.pinming == '纱窗' or dingdan.chanpin.pinming == '窗花' %}

                                                    <li>位置: {{ dingdan.weizhi }}</li>
                                                    {#                                                <li>数量: {{ dingdan.shuliang }}</li>#}
                                                    <li>型号: {{ dingdan.xinghao }}</li>
                                                    <li>宽(mm): {{ dingdan.kuan_chang }}</li>
                                                    <li>高(mm): {{ dingdan.gao }}</li>
                                                    <li>颜色: {{ dingdan.color }}</li>

                                                    <li>底高(mm): {{ dingdan.meikuan_digao }}</li>
                                                    <li>等分数: {{ dingdan.dengfenshu }}</li>
                                                    <li>有否横条: {{ dingdan.ishaveht }}</li>
                                                    <li>锁位: {{ dingdan.shuowei }}</li>



                                                {% elif dingdan.chanpin.pinming == '指纹锁' %}

                                                    <li>位置: {{ dingdan.weizhi }}</li>
                                                    {#                                                <li>数量: {{ dingdan.shuliang }}</li>#}
                                                    <li>型号: {{ dingdan.xinghao }}</li>
                                                    <li>颜色: {{ dingdan.color }}</li>

                                                    <li>锁位: {{ dingdan.shuowei }}</li>

                                                {% elif dingdan.chanpin.pinming == '杂项' %}

                                                    <li>位置: {{ dingdan.weizhi }}</li>
                                                    <li>数量: {{ dingdan.shuliang }}</li>
                                                    <li>型号: {{ dingdan.xinghao }}</li>

                                                    <li>备注: {{ dingdan.beizhu }}</li>

                                                {% endif %}

                                            </ul>
                                        </blockquote>
                                    </div>
                                    <div class="panel-footer">状态: {{ dingdan.status }}

                                        {% if dingdan.status == 1 %}
                                            「已量尺」
                                        {% elif dingdan.status == 2 %}
                                            「已下单」
                                        {% elif dingdan.status == 3 %}
                                            「已订货」
                                        {% elif dingdan.status == 4 %}
                                            「已入库」
                                        {% elif dingdan.status == 5 %}
                                            「已发货」
                                        {% elif dingdan.status == 6 %}
                                            「已收货」
                                        {% elif dingdan.status == 7 %}
                                            「安装中」
                                        {% elif dingdan.status == 8 %}
                                            「完成安装」
                                        {% elif dingdan.status == 9 %}
                                            「已清款」
                                        {% else %}
                                            「状态有误」
                                        {% endif %}


                                    </div>
                                </div>

                            {% endif %}
                        {% endfor %}


                    </blockquote>


                </div>
                {#           <div class="panel-footer"></div>#}
            </div>

        {% endfor %}


    {% else %}
        {% for kehu in kehus %}
            {% for dingdan in kehu.dingdans %}
                {% if dingdan.status == status and (dingdan.chanpin_id==chanpin or chanpin==0 ) %}


                    <h4><label class="checkbox-inline"><input name="willsel" type="checkbox"
                                                              value="{{ dingdan.id }}"/>选择
                        订单号({{ dingdan.id }})

                        {#                        {% if dingdan.status == 0 %}#}
                        {#                            「所有进度」#}
                        {#                        {% elif dingdan.status == 1 %}#}
                        {#                            「已量尺」#}
                        {#                        {% elif dingdan.status == 2 %}#}
                        {#                            「已下单」#}
                        {#                        {% elif dingdan.status == 3 %}#}
                        {#                            「已订货」#}
                        {#                        {% elif dingdan.status == 4 %}#}
                        {#                            「已入库」#}
                        {#                        {% elif dingdan.status == 5 %}#}
                        {#                            「已发货」#}
                        {#                        {% elif dingdan.status == 6 %}#}
                        {#                            「已收货」#}
                        {#                        {% elif dingdan.status == 7 %}#}
                        {#                            「安装中」#}
                        {#                        {% elif dingdan.status == 8 %}#}
                        {#                            「完成安装」#}
                        {#                        {% elif dingdan.status == 9 %}#}
                        {#                            「已清款」#}
                        {#                        {% else %}#}
                        {#                            「状态有误」#}
                        {#                        {% endif %}#}

                        {{ dingdan.chanpin.pinming }}
                    </label>
                        {% if dingdan.status == 3 %}
                            [下订：{{ moment(dingdan.time3).format('YYYY.MM.D') }}]

                        {% elif dingdan.status == 6 %}
{#                            ( {{ moment(dingdan.time5).fromNow(refresh=True) }} 收货)#}
                            ({{ moment(dingdan.time6).format('YY年M月D日') }} 收货)
                            <a class="btn btn-danger  glyphicon glyphicon-repeat"
                               href="{{ url_for('main.unshouhuoone', ddid=dingdan.id) }}"> 撤收</a>
                        {% endif %}
                        {{ dingdan.weizhi }}
                    </h4>

                    <p>客户号({{ kehu.id }}) {{ kehu.xiaoqu.xiaoqu }}「 {{ kehu.xiaoqu.dizhi }} 」{{ kehu.fangjian }}<br>
                        {{ kehu.chenghu }}({{ kehu.tel }})
                    </p>
                    <hr>
                {% endif %}
            {% endfor %}
        {% endfor %}
    {% endif %}

    {% if status == 0 or status == 3 %}
        <div class="panel panel-default">
            <div class="panel-heading">

                <label class="checkbox-inline"><input name="checkboxMain" type="checkbox" onclick="CheckAll(this);"/> 全选
                </label>


                {#                <button id="selall" class="btn btn-success glyphicon glyphicon-check">全选</button>#}
                {#                <button id="allnotsel" class="btn btn-success glyphicon glyphicon-share">全否</button>#}

{#                设置收货日期：<input id="indate" type="date">#}

                <button id="doshouhou" class="btn btn-primary glyphicon glyphicon-gift"> 对所选收货</button>

                {#                        <a class="btn btn-primary " href="{{  url_for('main.dinghuoedlist') }}" >转－已订货</a>#}

            </div>
        </div>
    {% endif %}
    {#    <div class="page-header">#}
    {#    <h4>业务员：{{ current_user.username }}</h4>#}
    {#        <p>客户列表</p>#}
    {#        <a class="btn btn-default" href="{{  url_for('main.addkehu') }}" >添加客户</a>#}
    {#    </div>#}


    {##}
    {#<table class="table">#}
    {#  <thead>#}
    {#    <tr>#}
    {#      <th>id</th>#}
    {#      <th>小区</th>#}
    {#      <th>栋数</th>#}
    {#      <th>房号</th>#}
    {#      <th>称呼</th>#}
    {#      <th>手机</th>#}
    {#      <th>状态<th>#}
    {#      <th>date<th>#}
    {#    </tr>#}
    {#  </thead>#}
    {#  <tbody>#}
    {##}
    {#    {% for kehu in kehus %}#}
    {#    <tr>#}
    {#      <td>{{ bujuan.xiangmu.xiangmu }}</td>#}
    {#      <td>#}
    {#          {{ kehu.id }}#}
    {##}
    {#          {% for dingdan in kehu.dingdans %}#}
    {#             {{ dingdan.chanpin.pinming }} ({{ dingdan.shuliang }} ) /#}
    {#          {% endfor %}#}
    {##}
    {##}
    {#          <a class="btn btn-danger" href="{{  url_for('main.showkehudd', id=kehu.id) }}" >编辑订单</a>#}
    {#          <a class="btn btn-danger" href="{{  url_for('main.viewkehudd', id=kehu.id) }}" >显示</a>#}
    {#      </td>#}
    {#      <td>{{ kehu.xiaoqu.xiaoqu }}</td>#}
    {#      <td>{{ kehu.donghao }}</td>#}
    {#      <td>{{ kehu.fanghao }}</td>#}
    {#      <td>{{ kehu.chenghu }}</td>#}
    {#      <td>{{ kehu.tel }}</td>#}
    {#      <td>{{ kehu.status }}</td>#}
    {#      <!--td>{{ moment(kehu.xdtime).format('YY年M月D日') }}</td-->#}
    {#      <td>{{ moment(kehu.xdtime).fromNow(refresh=True) }}{% if loop.first %}<!--span class="badge">新</span-->{% endif %}#}
    {##}
    {#          <a class="btn btn-danger" href="{{  url_for('main.delkehu', id=kehu.id) }}" >删除</a>#}
    {#          <a class="btn btn-primary" href="{{  url_for('main.editkehu', id=kehu.id) }}" >修改</a>#}
    {#      </td>#}
    {##}
    {#    </tr>#}
    {##}
    {#    {% endfor %}#}
    {#  </tbody>#}
    {#</table>#}



    {#<table class="table">#}
    {#  <thead>#}
    {#    <tr>#}
    {#      <th>项目</th>#}
    {#      <th>金额</th>#}
    {#      <!--th>日期</th-->#}
    {#      <th>经过</th>#}
    {#    </tr>#}
    {#  </thead>#}
    {#  <tbody>#}
    {##}
    {#    {% for bujuan in bujuans %}#}
    {#    <tr>#}
    {#      <td>{{ bujuan.xiangmu.xiangmu }}</td>#}
    {#      <td>{{ bujuan.jine }}</td>#}
    {#      <!--td>{{ moment(bujuan.outtime).format('YY年M月D日') }}</td-->#}
    {#      <td>{{ moment(bujuan.outtime).fromNow(refresh=True) }}{% if loop.first %}<!--span class="badge">新</span-->{% endif %}</td>#}
    {##}
    {#    </tr>#}
    {##}
    {#    {% endfor %}#}
    {#  </tbody>#}
    {#</table>#}

{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript">

        {#$(':checkbox').checkboxpicker();#}
        {##}
        {#$('input[name="willsel"]').checkboxpicker({#}
        {#  html: true,#}
        {#  offLabel: '<span class="glyphicon glyphicon-remove">',#}
        {#  onLabel: '<span class="glyphicon glyphicon-ok">'#}
        {# }); #}

        {#Date.prototype.toDateInputValue = (function() {#}
        {#    var local = new Date(this);#}
        {#    local.setMinutes(this.getMinutes() - this.getTimezoneOffset());#}
        {#    return local.toJSON().slice(0,10);#}
        {# });#}
        {##}
        {#$(document).ready( function() {#}
        {#    //$('#indate').val(new Date().toDateInputValue());#}
        {#    document.getElementById('indate').value = new Date().toDateInputValue();#}
        {# });​#}



        function CheckAll(obj) {
            //获取checked属性
            if ($(obj).prop("checked")) {
                //设置checked属性
                $("input[name='willsel']").prop("checked", true);
            } else {
                //设置checked属性
                $("input[name='willsel']").prop("checked", false);
            }
        }


        $("#doshouhou").click(function () {

            var selids = ''
            $.each($('input[name="willsel"]:checkbox:checked'), function () {
                //window.alert("你选了："+$('input[type=checkbox]:checked').length+"个，其中有："+$(this).val());

                selids = selids + $(this).val() + ','
            });
            //alert(selids);

            $.ajax({
                type: "get",
                {#url : "{{ url_for('main.doselshouhuo',selids) }}",#}
                {#data : "",#}

                {#url : "doselshouhuo",#}
                {#data : "selids=" + selids,#}

                url: "doselshouhuo/" + selids,
                {#data : "selids=" + selids,                #}
                async: true,
                success: function (data) {
                    //sdata = eval("(" + data + ")");
                    //aDataSet = data;
                    //alert(data);
                    //opener.location.reload()
                    window.location.reload()

                }
            });

        });
    </script>

{% endblock %}
